{% extends 'base.html.twig' %}

{% block title %}Contrat de Prêt #{{ contratPret.numContrat }}{% endblock %}

{% block body %}

<div class="show-container">
    <h1><i class="fa-solid fa-file-signature"></i> Contrat de Prêt #{{ contratPret.numContrat }}</h1>

    {# --- SECTION 1 : INFORMATIONS DU CONTRAT --- #}
    <h3 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
        <i class="fa-solid fa-circle-info"></i> Informations Générales
    </h3>

    <div class="info-grid">
        
        {# Numéro #}
        <div class="info-item">
            <span class="info-label"><i class="fa-solid fa-hashtag"></i> Numéro de contrat</span>
            <span class="info-value">{{ contratPret.numContrat }}</span>
        </div>

        {# Assurance #}
        <div class="info-item">
            <span class="info-label"><i class="fa-solid fa-shield-halved"></i> Assurance Fournie</span>
            <span class="info-value">
                {% if contratPret.isAttestationAssurance %}
                    <span style="color: green; font-weight: bold;"><i class="fa-solid fa-check"></i> Oui</span>
                {% else %}
                    <span style="color: red; font-weight: bold;"><i class="fa-solid fa-xmark"></i> Non</span>
                {% endif %}
            </span>
        </div>

        {# Date Début #}
        <div class="info-item">
            <span class="info-label"><i class="fa-regular fa-calendar-check"></i> Date de Début</span>
            <span class="info-value">{{ contratPret.dateDebut ? contratPret.dateDebut|date('d/m/Y') : 'N/A' }}</span>
        </div>

        {# Date Fin #}
        <div class="info-item">
            <span class="info-label"><i class="fa-regular fa-calendar-xmark"></i> Date de Fin Prévue</span>
            <span class="info-value" style="color: #e74c3c;">{{ contratPret.dateFin ? contratPret.dateFin|date('d/m/Y') : 'N/A' }}</span>
        </div>

        {# États (Pleine largeur) #}
        <div class="info-item" style="grid-column: 1 / -1;">
            <span class="info-label"><i class="fa-solid fa-clipboard-list"></i> État au départ</span>
            <span class="info-value" style="font-style: italic; font-size: 1rem;">
                {{ contratPret.etatDetailleDebut ? contratPret.etatDetailleDebut|nl2br : 'Non renseigné' }}
            </span>
        </div>

        <div class="info-item" style="grid-column: 1 / -1;">
            <span class="info-label"><i class="fa-solid fa-clipboard-check"></i> État au retour</span>
            <span class="info-value" style="font-style: italic; font-size: 1rem;">
                {{ contratPret.etatDetailleRetour ? contratPret.etatDetailleRetour|nl2br : 'Non renseigné (Prêt en cours)' }}
            </span>
        </div>
    </div>

    {# --- SECTION 2 : L'ÉLÈVE --- #}
    {% if contratPret.eleve %}
        {% set eleve = contratPret.eleve %}
        <h3 style="color: #2c3e50; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fa-solid fa-user-graduate"></i> Élève Emprunteur
        </h3>

        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Nom Complet</span>
                <span class="info-value">{{ eleve.prenom }} {{ eleve.nom }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Contact</span>
                <span class="info-value">{{ eleve.mail }} <br> {{ eleve.tel }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Adresse</span>
                <span class="info-value">
                    {{ eleve.numRue }} {{ eleve.rue }}<br>
                    {{ eleve.copos }} {{ eleve.ville }}
                </span>
            </div>
            <div class="info-item">
                <span class="info-label">Tranche d'âge</span>
                <span class="info-value">{{ eleve.tranche ? eleve.tranche.libelle : 'N/A' }}</span>
            </div>
        </div>
    {% endif %}

    {# --- SECTION 3 : L'INSTRUMENT --- #}
    {% if contratPret.instrument %}
        {% set instrument = contratPret.instrument %}
        <h3 style="color: #2c3e50; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fa-solid fa-guitar"></i> Instrument Prêté
        </h3>

        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Type</span>
                <span class="info-value">{{ instrument.typeInstrument ? instrument.typeInstrument.libelle : 'N/A' }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Numéro de Série</span>
                <span class="info-value">{{ instrument.numSerie }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Prix de l'instrument</span>
                <span class="info-value">{{ instrument.prixAchat ? (instrument.prixAchat|number_format(2, ',', ' ') ~ ' €') : 'N/A' }}</span>
            </div>
            
            {# Couleurs #}
            <div class="info-item" style="grid-column: 1 / -1;">
                <span class="info-label">Couleurs</span>
                <div class="info-value list-chips">
                    {% if instrument.couleurs is not empty %}
                        {% for couleur in instrument.couleurs %}
                            <span class="chip">{{ couleur.nom }}</span>
                        {% endfor %}
                    {% else %}
                        <span style="color: #999; font-style: italic;">Aucune couleur</span>
                    {% endif %}
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-danger" style="margin-top: 20px;">
            <i class="fa-solid fa-triangle-exclamation"></i> Aucun instrument n'est actuellement lié à ce contrat.
        </div>
    {% endif %}

    {# --- ACTIONS --- #}
    <div class="actions">
        {# Bouton Retour #}
        <a href="{{ path('app_contrat_pret_index') }}" class="btn-action btn-back">
            <i class="fa-solid fa-arrow-left"></i> Retour à la liste
        </a>

        {# Bouton Modifier #}
        <a href="{{ path('app_contrat_pret_edit', {'id': contratPret.id}) }}" class="btn-action btn-edit">
            <i class="fa-solid fa-pen-to-square"></i> Modifier le contrat
        </a>
    </div>

</div>
{% endblock %}